// Scroll reveal animation
const revealElements = document.querySelectorAll(
  '.clo-card, .fn-card, .inv-item, .risk-card, .en-card, .app-card, ' +
  '.pipe-step, .compare-card, .defect-item, .kpi-card, .method-step, ' +
  '.classify-block, .info-banner, .why-cards'
);

revealElements.forEach(el => el.classList.add('reveal'));

const observer = new IntersectionObserver((entries) => {
  entries.forEach((entry, i) => {
    if (entry.isIntersecting) {
      setTimeout(() => {
        entry.target.classList.add('visible');
      }, (Array.from(revealElements).indexOf(entry.target) % 6) * 80);
      observer.unobserve(entry.target);
    }
  });
}, { threshold: 0.12 });

revealElements.forEach(el => observer.observe(el));

// Smooth active nav pill highlight
const sections = document.querySelectorAll('section[id]');
const pills = document.querySelectorAll('.pill');

window.addEventListener('scroll', () => {
  let current = '';
  sections.forEach(section => {
    if (window.scrollY >= section.offsetTop - 200) {
      current = section.getAttribute('id');
    }
  });
  pills.forEach(pill => {
    pill.style.background = pill.getAttribute('href') === `#${current}` ? '#2d2d3a' : '';
    pill.style.color = pill.getAttribute('href') === `#${current}` ? '#fff' : '';
  });
});

// ═══════════════════════════════════════
// EXAM PREP — Tab switching
// ═══════════════════════════════════════
const examTabs = document.querySelectorAll('.exam-tab');
const examPanels = document.querySelectorAll('.exam-panel');

examTabs.forEach(tab => {
  tab.addEventListener('click', () => {
    examTabs.forEach(t => t.classList.remove('active'));
    examPanels.forEach(p => p.classList.remove('active'));
    tab.classList.add('active');
    const target = document.getElementById('panel-' + tab.dataset.panel);
    if (target) target.classList.add('active');
    updateProgress();
  });
});

// ═══════════════════════════════════════
// EXAM PREP — Reveal Answer buttons
// ═══════════════════════════════════════
document.querySelectorAll('.eq-reveal-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const card = btn.closest('.eq-card');
    card.classList.toggle('open');

    const isNowOpen = card.classList.contains('open');
    // Update button label (first text node)
    btn.firstChild.textContent = isNowOpen ? 'Hide Answer ' : 'Reveal Answer ';

    updateProgress();
  });
});

// ═══════════════════════════════════════
// EXAM PREP — Progress tracker
// ═══════════════════════════════════════
function updateProgress() {
  const activePanel = document.querySelector('.exam-panel.active');
  if (!activePanel) return;

  const total = activePanel.querySelectorAll('.eq-card').length;
  const done  = activePanel.querySelectorAll('.eq-card.open').length;

  const labelDone  = document.querySelector('.prog-done');
  const labelTotal = document.querySelector('.prog-total');
  const fill       = document.querySelector('.exam-progress-fill');

  if (labelDone)  labelDone.textContent  = done;
  if (labelTotal) labelTotal.textContent = total;
  if (fill) fill.style.width = total > 0 ? (done / total * 100) + '%' : '0%';
}

document.addEventListener('DOMContentLoaded', updateProgress);
